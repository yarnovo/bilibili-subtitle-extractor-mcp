# Bilibiliå­—å¹•æå–MCPå·¥å…·

## ğŸ“– é¡¹ç›®èƒŒæ™¯

éšç€AIåŠ©æ‰‹çš„æ™®åŠï¼Œç”¨æˆ·ç»å¸¸éœ€è¦ä»Bilibiliè§†é¢‘ä¸­æå–å­—å¹•å†…å®¹è¿›è¡Œåˆ†æã€æ€»ç»“æˆ–å­¦ä¹ ã€‚æœ¬å·¥å…·åŸºäºModel Context Protocol (MCP)æ ‡å‡†ï¼Œæä¾›äº†ä¸€ä¸ªç®€å•è€Œå¼ºå¤§çš„è§£å†³æ–¹æ¡ˆï¼Œè®©AIåŠ©æ‰‹èƒ½å¤Ÿç›´æ¥è·å–Bç«™è§†é¢‘çš„å­—å¹•æ•°æ®ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ¯ **ç²¾å‡†æå–**: ä»ä»»æ„Bilibiliè§†é¢‘ä¸­æå–å®Œæ•´å­—å¹•å†…å®¹
- âš¡ **å®æ—¶é€šä¿¡**: åŸºäºWebSocketçš„æµè§ˆå™¨æ’ä»¶é€šä¿¡æ¶æ„
- ğŸ”— **æ—¶é—´æˆ³é“¾æ¥**: æ”¯æŒç”Ÿæˆå¸¦æ—¶é—´æˆ³çš„è§†é¢‘è·³è½¬é“¾æ¥
- ğŸ‹ **Dockeréƒ¨ç½²**: æ”¯æŒå¤šç§éƒ¨ç½²æ–¹å¼ï¼Œä¸€é”®å¯åŠ¨æœåŠ¡
- ğŸ”Œ **MCPæ ‡å‡†**: å®Œå…¨å…¼å®¹Model Context Protocolè§„èŒƒ
- ğŸŒ **è·¨å¹³å°**: æ”¯æŒChrome/Edgeæµè§ˆå™¨æ‰©å±•
- ğŸ“Š **çŠ¶æ€ç›‘æ§**: å®æ—¶æŸ¥çœ‹æœåŠ¡çŠ¶æ€å’Œæ’ä»¶è¿æ¥æƒ…å†µ

## ğŸš€ å®‰è£…å’Œä½¿ç”¨

### å¿…è¦æ¡ä»¶
âš ï¸ **é‡è¦è¯´æ˜**: æœ¬å·¥å…·éœ€è¦é…åˆæµè§ˆå™¨æ’ä»¶ä½¿ç”¨ï¼Œæ— æ³•ç‹¬ç«‹è¿è¡Œã€‚

**ç³»ç»Ÿè¦æ±‚:**
- Node.js >= 20.0.0
- Docker & Docker Compose (æ¨è)
- Chrome/Edgeæµè§ˆå™¨
- æœ‰æ•ˆçš„Bilibiliè´¦å·

**æµè§ˆå™¨æ’ä»¶å®‰è£…:**

æ’ä»¶æä¾›ä¸¤ç§å®‰è£…æ–¹å¼ï¼š

1. **æ¨èæ–¹å¼**: ç›´æ¥ä¸‹è½½å·²æ„å»ºç‰ˆæœ¬
   - è®¿é—®æ’ä»¶å‘å¸ƒé¡µé¢: [GitHub Releases](https://github.com/yarnovo/bilibili-subtitle-extractor-extension/releases)
   - ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„å‹ç¼©åŒ…
   - è§£å‹ååœ¨Chromeä¸­åŠ è½½æ‰©å±•ç¨‹åº

2. **æœ¬åœ°æ„å»ºæ–¹å¼**:
   ```bash
   # å…‹éš†æ’ä»¶é¡¹ç›®
   git clone https://github.com/yarnovo/bilibili-subtitle-extractor-extension.git
   cd bilibili-subtitle-extractor-extension
   
   # å®‰è£…ä¾èµ–å¹¶æ„å»º
   npm install
   npm run build
   ```

3. **åœ¨æµè§ˆå™¨ä¸­åŠ è½½æ’ä»¶**:
   - æ‰“å¼€æ‰©å±•ç¨‹åºç®¡ç†é¡µé¢ (chrome://extensions/)
   - å¯ç”¨"å¼€å‘è€…æ¨¡å¼"
   - ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"
   - é€‰æ‹©è§£å‹åçš„æ–‡ä»¶å¤¹æˆ–æ„å»ºåçš„`dist`ç›®å½•

### æ–¹å¼ä¸€ï¼šDockeré•œåƒéƒ¨ç½²ï¼ˆæ¨èï¼‰

#### 1. ç›´æ¥è¿è¡Œå®˜æ–¹é•œåƒ
```bash
# æ‹‰å–å¹¶è¿è¡Œå®˜æ–¹é•œåƒ
docker run -d \
  --name bilibili-subtitle-extractor \
  -p 3456:3456 \
  -p 8080:8080 \
  --restart unless-stopped \
  yarnovo/bilibili-subtitle-extractor-mcp:latest
```

#### 2. ä½¿ç”¨Docker Compose
åˆ›å»º `docker-compose.yml` æ–‡ä»¶ï¼š
```yaml
version: '3.8'
services:
  bilibili-subtitle-extractor:
    image: yarnovo/bilibili-subtitle-extractor-mcp:latest
    container_name: bilibili-subtitle-extractor-mcp
    ports:
      - "3456:3456"  # HTTP MCPæ¥å£ç«¯å£
      - "8080:8080"  # WebSocketç«¯å£
    restart: unless-stopped
```

å¯åŠ¨æœåŠ¡ï¼š
```bash
docker-compose up -d
```

### æ–¹å¼äºŒï¼šæœ¬åœ°Dockeræ„å»ºéƒ¨ç½²

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/yarnovo/bilibili-subtitle-extractor-mcp.git
cd bilibili-subtitle-extractor-mcp

# ä½¿ç”¨Docker Composeæ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build
```

### æ–¹å¼ä¸‰ï¼šæœ¬åœ°å¼€å‘éƒ¨ç½²

#### 1. å®‰è£…ä¾èµ–
```bash
npm install
```

#### 2. æ„å»ºé¡¹ç›®
```bash
npm run build
```

#### 3. å¯åŠ¨æœåŠ¡
```bash
npm start
# æˆ–ç›´æ¥è¿è¡Œ
node dist/main/index.js
```

### ğŸ” éªŒè¯å®‰è£…

æœåŠ¡å¯åŠ¨åï¼Œä½ å°†çœ‹åˆ°ï¼š
```
ğŸš€ å¯åŠ¨Bilibiliå­—å¹•æå–MCPæœåŠ¡å™¨...
ğŸ”Œ WebSocketæœåŠ¡å™¨: ws://localhost:8080
âœ… æœåŠ¡å™¨å¯åŠ¨å®Œæˆï¼
ğŸ“¡ HTTPæœåŠ¡å™¨: http://localhost:3456
ğŸ“‹ MCPæ¥å£: http://localhost:3456/mcp
ğŸ“Š çŠ¶æ€é¡µé¢: http://localhost:3456/
```

**éªŒè¯è¿æ¥:**
1. è®¿é—®ä»»æ„Bç«™è§†é¢‘é¡µé¢ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨è¿æ¥åˆ°WebSocketæœåŠ¡å™¨
2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ŒæŸ¥çœ‹Consoleæ˜¯å¦æœ‰è¿æ¥æˆåŠŸçš„æ¶ˆæ¯
3. è®¿é—® `http://localhost:3456/` æŸ¥çœ‹æœåŠ¡çŠ¶æ€

### ğŸ“‹ æœåŠ¡ç®¡ç†

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down

# é‡å¯æœåŠ¡
docker-compose restart
```

## ğŸ›  å¯ç”¨å·¥å…·

### 1. extract_bilibili_subtitles
ä»Bilibiliè§†é¢‘ä¸­æå–å­—å¹•ã€‚**éœ€è¦æµè§ˆå™¨æ’ä»¶é…åˆä½¿ç”¨ã€‚**

**å‚æ•°ï¼š**
- `video_url` (å¿…éœ€): Bilibiliè§†é¢‘URLï¼ˆå®Œæ•´é“¾æ¥ï¼ŒåŒ…å«BVå·ï¼‰
- `timeout` (å¯é€‰): è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤30ç§’

**ç¤ºä¾‹ä½¿ç”¨ï¼š**
```json
{
  "video_url": "https://www.bilibili.com/video/BV1234567890",
  "timeout": 30000
}
```

**è¿”å›æ•°æ®æ ¼å¼ï¼š**
```json
{
  "success": true,
  "data": {
    "title": "è§†é¢‘æ ‡é¢˜",
    "author": "UPä¸»åç§°",
    "url": "è§†é¢‘URL",
    "ctime": åˆ›å»ºæ—¶é—´æˆ³,
    "subtitles": [
      {
        "from": å¼€å§‹æ—¶é—´(ç§’),
        "to": ç»“æŸæ—¶é—´(ç§’),
        "content": "å­—å¹•å†…å®¹"
      }
    ]
  },
  "renderingNote": "å­—å¹•æ¸²æŸ“å»ºè®®..."
}
```

### 2. get_connection_status
è·å–ä¸æµè§ˆå™¨æ’ä»¶çš„è¿æ¥çŠ¶æ€

**è¿”å›ä¿¡æ¯ï¼š**
- `pluginConnected`: æ’ä»¶æ˜¯å¦å·²è¿æ¥
- `pendingRequests`: å¾…å¤„ç†è¯·æ±‚æ•°é‡
- `message`: è¿æ¥çŠ¶æ€è¯´æ˜
- `timestamp`: çŠ¶æ€æ£€æŸ¥æ—¶é—´

## ğŸ“ å­—å¹•æ¸²æŸ“å»ºè®®

å·¥å…·è¿”å›çš„å­—å¹•æ•°æ®åŒ…å«æ—¶é—´æˆ³ä¿¡æ¯ï¼Œå»ºè®®ä¸ºç”¨æˆ·å±•ç¤ºå¸¦æ—¶é—´æˆ³è·³è½¬é“¾æ¥çš„æ ¼å¼ï¼š

```
[00:15](https://www.bilibili.com/video/BV1234567890?t=15) å¤§å®¶å¥½ï¼Œæ¬¢è¿æ¥åˆ°æˆ‘çš„ç¼–ç¨‹æ•™ç¨‹
[00:18](https://www.bilibili.com/video/BV1234567890?t=18) ä»Šå¤©æˆ‘ä»¬è¦å­¦ä¹ å¦‚ä½•å…¥é—¨ç¼–ç¨‹
[01:07](https://www.bilibili.com/video/BV1234567890?t=67) Pythonæ˜¯ä¸€ä¸ªéå¸¸é€‚åˆåˆå­¦è€…çš„è¯­è¨€
```

**æ ¼å¼è¯´æ˜ï¼š**
- `[MM:SS]`: æ ¼å¼åŒ–çš„æ—¶é—´æˆ³ï¼ˆæ ¹æ®fromå­—æ®µè½¬æ¢ï¼‰
- é“¾æ¥ä¸­çš„ç§’æ•°æ¥è‡ªfromå­—æ®µçš„å€¼ï¼ˆå‘ä¸‹å–æ•´ï¼‰
- ç”¨æˆ·ç‚¹å‡»æ—¶é—´æˆ³å¯ç›´æ¥è·³è½¬åˆ°è§†é¢‘å¯¹åº”æ—¶é—´ç‚¹

## â— é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

1. **"æµè§ˆå™¨æ’ä»¶æœªè¿æ¥"**
   - ç¡®è®¤æµè§ˆå™¨æ’ä»¶å·²å®‰è£…å¹¶å¯ç”¨
   - æ£€æŸ¥æ’ä»¶æ˜¯å¦åœ¨Bç«™é¡µé¢æ­£å¸¸å·¥ä½œ
   - è®¿é—® `http://localhost:3456/` æŸ¥çœ‹è¿æ¥çŠ¶æ€
   - æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰è¿æ¥é”™è¯¯

2. **"å­—å¹•æå–è¶…æ—¶"**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
   - ç¡®è®¤è§†é¢‘URLæ ¼å¼æ­£ç¡®ï¼ˆåŒ…å«BVå·ï¼‰
   - å°è¯•å¢åŠ timeoutå‚æ•°å€¼
   - ç¡®è®¤æ’ä»¶åœ¨Bç«™é¡µé¢æ­£å¸¸è¿è¡Œ

3. **"DockeræœåŠ¡å¯åŠ¨å¤±è´¥"**
   - ç¡®è®¤Dockerå’ŒDocker Composeå·²å®‰è£…
   - æ£€æŸ¥ç«¯å£3456å’Œ8080æ˜¯å¦è¢«å ç”¨
   - æŸ¥çœ‹Dockeræ—¥å¿—ï¼š`docker-compose logs -f`

## ğŸ— æ ¸å¿ƒæ¶æ„

### æœåŠ¡æ¶æ„
- **HTTP MCPæœåŠ¡å™¨**: æä¾›æ ‡å‡†MCPåè®®æ¥å£ (ç«¯å£3456)
- **WebSocketæœåŠ¡å™¨**: ä¸æµè§ˆå™¨æ’ä»¶é€šä¿¡ (ç«¯å£8080)
- **æµè§ˆå™¨æ’ä»¶**: åœ¨Bç«™é¡µé¢æ‰§è¡Œå­—å¹•æå–ï¼Œé€šè¿‡WebSocketæ¨é€ç»“æœ

### WebSocketé€šä¿¡åè®®

#### æ’ä»¶ â†’ æœåŠ¡å™¨ (å­—å¹•æå–ç»“æœ)
```json
{
  "type": "SUBTITLE_RESULT",
  "requestId": "uuid",
  "data": {
    "title": "è§†é¢‘æ ‡é¢˜",
    "author": "UPä¸»åç§°",
    "url": "è§†é¢‘URL",
    "ctime": æ—¶é—´æˆ³,
    "subtitles": [...]
  }
}
```

#### æœåŠ¡å™¨ â†’ æ’ä»¶ (å­—å¹•æå–è¯·æ±‚)
```json
{
  "type": "GET_SUBTITLE",
  "videoUrl": "https://...",
  "requestId": "uuid"
}
```

### Dockeréƒ¨ç½²æ¶æ„
- **å¤šé˜¶æ®µæ„å»º**: æ„å»ºé˜¶æ®µç¼–è¯‘TypeScriptï¼Œè¿è¡Œé˜¶æ®µä»…åŒ…å«å¿…è¦æ–‡ä»¶
- **ç«¯å£æ˜ å°„**: 3456 (HTTP)ã€8080 (WebSocket)
- **å¥åº·æ£€æŸ¥**: å®šæœŸæ£€æŸ¥HTTPæœåŠ¡å¯ç”¨æ€§
- **æ—¥å¿—ç®¡ç†**: é™åˆ¶æ—¥å¿—æ–‡ä»¶å¤§å°å’Œæ•°é‡

## ğŸ”§ å¼€å‘è°ƒè¯•

### æœ¬åœ°å¼€å‘
```bash
# å®‰è£…ä¾èµ–
npm install

# æ„å»ºé¡¹ç›®
npm run build

# å¯åŠ¨å¼€å‘æ¨¡å¼
npm start

# è¿è¡Œæµ‹è¯•
npm test
```

### Dockerå¼€å‘
```bash
# æ„å»ºé•œåƒ
docker-compose build

# å¯åŠ¨æœåŠ¡ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
docker-compose up

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f bilibili-subtitle-extractor
```

### æ’ä»¶å¼€å‘
æ’ä»¶æºç ä½äºç‹¬ç«‹ä»“åº“ï¼š
- æ’ä»¶ä»“åº“ï¼šhttps://github.com/yarnovo/bilibili-subtitle-extractor-extension
- æ„å»ºæ’ä»¶ï¼š`npm run build`
- åŠ è½½åˆ°æµè§ˆå™¨è¿›è¡Œæµ‹è¯•

### çŠ¶æ€ç›‘æ§
- è®¿é—® `http://localhost:3456/` æŸ¥çœ‹æœåŠ¡çŠ¶æ€
- ä½¿ç”¨ `get_connection_status` å·¥å…·æ£€æŸ¥æ’ä»¶è¿æ¥

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤ä»£ç æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»ºPull Request

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ 